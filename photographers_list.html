<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kemograghy — المصورين</title>
<link rel="stylesheet" href="photographers.css">
<style>
/* إضافات خاصة بصفحة المصورين */
.controls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; margin:18px 0; }
.controls input, .controls select { padding:8px 10px; border-radius:8px; border:1px solid #ddd; min-width:160px; }
.controls label { font-size:14px; margin-left:6px; }

.container-cards { display:flex; flex-wrap:wrap; gap:18px; justify-content:center; padding-bottom:40px; }

.card {
  width:220px; background:#fff; border-radius:12px; padding:12px; text-align:center;
  box-shadow:0 6px 18px rgba(15,15,15,0.06); display:flex; flex-direction:column; gap:8px;
}
.card img { width:100px; height:100px; border-radius:50%; object-fit:cover; margin-inline:auto; }
.card h3 { margin:0; font-size:16px; }
.meta { font-size:13px; color:#666; }
.badge { display:inline-block; padding:4px 8px; border-radius:999px; font-weight:600; font-size:13px; }
.badge.available { background:#e8f6ea; color:#1a8a2a; }
.badge.busy { background:#fdecea; color:#b31b1b; }
.card .actions { margin-top:auto; display:flex; gap:8px; justify-content:center; }
.btn.small { padding:6px 10px; font-size:13px; }
.filter-row { display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:8px; }
.no-results { text-align:center; color:#666; padding:20px; }

/* Modal */
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:50; }
.modal { background:#fff; width:min(880px,95%); border-radius:12px; padding:18px; box-shadow:0 6px 24px rgba(0,0,0,.2); display:grid; grid-template-columns: 260px 1fr; gap:18px; align-items:start; }
.modal .gallery { display:flex; flex-direction:column; gap:8px; }
.modal .gallery img { width:100%; height:160px; object-fit:cover; border-radius:8px; }
.close-x { position:absolute; top:12px; left:12px; background:#fff; border-radius:8px; padding:6px; cursor:pointer; }

/* booking summary */
.book-summary { background:#f7f9fc; padding:12px; border-radius:8px; margin-top:8px; }
@media (max-width:700px) {
  .modal { grid-template-columns: 1fr; }
  .card { width:100%; max-width:360px; }
}
</style>
</head>
<body>

<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <span class="logo">📸</span>
      <span class="brand-name">Kemograghy</span>
    </div>
    <nav class="nav">
      <a href="photographers.html" class="btn">الرئيسية</a>
      <a href="login.html" class="btn small">تسجيل</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2 style="text-align:center;margin-top:18px">المصورين</h2>

  <div class="controls">
    <input id="qCity" placeholder="ابحث بالمدينة (مثال: جدة)" />
    <select id="qType">
      <option value="">كل الأنواع</option>
      <option value="property">تصوير عقاري</option>
      <option value="portrait">جلسات شخصية</option>
      <option value="event">فعاليات</option>
    </select>
    <select id="qAvailability">
      <option value="all">الكل</option>
      <option value="available">متاح حالياً</option>
      <option value="busy">غير متاح</option>
    </select>
    <select id="qSort">
      <option value="popular">الأكثر تقييماً</option>
      <option value="new">الأحدث</option>
      <option value="price_low">الأرخص</option>
    </select>
    <button id="clearFilters" class="btn">مسح الفلاتر</button>
  </div>

  <div id="cards" class="container-cards"></div>

  <div id="noResults" class="no-results" style="display:none">لم يتم العثور على مصورين بحسب معايير البحث.</div>
</main>

<footer class="site-footer">
  <div class="container">
    <p>© <span id="yr"></span> Kemograghy — منصة خدمة Kemstay</p>
  </div>
</footer>

<!-- Modal file -->
<div id="modalBackdrop" class="modal-backdrop" onclick="closeModal(event)">
  <div class="modal" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
    <button class="close-x" onclick="closeModal()">✕</button>
    <div class="gallery" id="modalGallery">
      <!-- صور -->
    </div>
    <div class="modal-body">
      <h3 id="modalName"></h3>
      <p class="meta" id="modalCity"></p>
      <p id="modalAbout" style="margin-top:8px">خبرة، معدات، نبذة قصيرة عن المصور.</p>

      <div style="margin-top:12px">
        <strong>الخدمات والأسعار</strong>
        <div id="modalServices"></div>
      </div>

      <div style="margin-top:12px">
        <strong>التقييمات</strong>
        <div id="modalReviews"></div>
      </div>

      <div class="book-summary">
        <h4>احجز الآن</h4>
        <label>التاريخ</label>
        <input id="bookDate" type="date" />
        <label>الوقت</label>
        <input id="bookTime" type="time" />
        <label>الخدمة</label>
        <select id="bookService"></select>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn primary" id="confirmBooking">تأكيد الحجز</button>
          <button class="btn" onclick="closeModal()">إلغاء</button>
        </div>

        <div id="bookingMsg" style="margin-top:10px;color:green;display:none"></div>
      </div>

    </div>
  </div>
</div>

<script>
/* بيانات وهمية (يمكن تعديل / إضافة) */
const photographers = [
  {
    id: 'p1',
    name: 'أحمد علي',
    city: 'الرياض',
    available: true,
    rating: 4.8,
    price_from: 200,
    services: [
      { key: 'property', name: 'تصوير عقاري (ساعه)', price: 200 },
      { key: 'portrait', name: 'جلسة شخصية (45 د)', price: 250 }
    ],
    profile_image: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=800&q=60',
    gallery: [
      'https://images.unsplash.com/photo-1508921912186-1d1a45ebb3c1?w=1200&q=60',
      'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1200&q=60'
    ],
    about: 'مصور محترف 7 سنوات خبرة، مختص بتصوير العقار والمشروعات العقارية.'
  },
  {
    id: 'p2',
    name: 'سارة محمد',
    city: 'جدة',
    available: false,
    rating: 4.6,
    price_from: 180,
    services: [
      { key: 'portrait', name: 'جلسة شخصية (30 د)', price: 180 },
      { key: 'event', name: 'تصوير فعاليات (ساعة)', price: 300 }
    ],
    profile_image: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=800&q=60',
    gallery: [
      'https://images.unsplash.com/photo-1524503033411-c9566986fc8f?w=1200&q=60'
    ],
    about: 'متخصصة بالبورتريه وفعاليات الشركات الصغيرة.'
  },
  {
    id: 'p3',
    name: 'محمد حسن',
    city: 'الدمام',
    available: true,
    rating: 4.9,
    price_from: 300,
    services: [
      { key: 'property', name: 'تصوير عقاري (باقة كاملة)', price: 700 },
      { key: 'event', name: 'توثيق فعاليات (3 ساعات)', price: 900 }
    ],
    profile_image: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=800&q=60',
    gallery: [
      'https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?w=1200&q=60',
      'https://images.unsplash.com/photo-1501876725168-00c445821c9e?w=1200&q=60'
    ],
    about: 'خبرة في تصوير المشاريع الكبيرة والعقارات الفاخرة.'
  },
  {
    id: 'p4',
    name: 'ليلى خالد',
    city: 'المدينة',
    available: true,
    rating: 4.5,
    price_from: 150,
    services: [
      { key: 'portrait', name: 'جلسة خارجية', price: 150 },
      { key: 'portrait', name: 'جلسة استديو', price: 220 }
    ],
    profile_image: 'https://images.unsplash.com/photo-1524504388940-7bfcf6b7d8a4?w=800&q=60',
    gallery: [
      'https://images.unsplash.com/photo-1519340333755-cb25a2ef6d5b?w=1200&q=60'
    ],
    about: 'مصورة مبدعة تركز على الإضاءة واللمسات الفنية.'
  }
];

/* state */
let results = [...photographers];
const cardsContainer = document.getElementById('cards');

function renderCards(list) {
  cardsContainer.innerHTML = list.map(p => `
    <div class="card" data-id="${p.id}">
      <img src="${p.profile_image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <div class="meta">${p.city} — ⭐ ${p.rating}</div>
      <div>
        <span class="badge ${p.available ? 'available' : 'busy'}">${p.available ? 'متاح حالياً' : 'غير متاح'}</span>
      </div>
      <div class="meta">ابتداءً من ${p.price_from} ريال</div>
      <div class="actions">
        <button class="btn small" onclick="openProfile('${p.id}')">عرض الملف</button>
        <a class="btn small" href="tel:0500000000">📞 اتصال</a>
      </div>
    </div>
  `).join('');
  document.getElementById('noResults').style.display = list.length ? 'none' : 'block';
}

/* فلاتر و بحث */
const qCity = document.getElementById('qCity');
const qType = document.getElementById('qType');
const qAvailability = document.getElementById('qAvailability');
const qSort = document.getElementById('qSort');
document.getElementById('clearFilters').addEventListener('click', () => {
  qCity.value = ''; qType.value = ''; qAvailability.value = 'all'; qSort.value = 'popular';
  applyFilters();
});

[qCity, qType, qAvailability, qSort].forEach(el => el.addEventListener('input', applyFilters));

function applyFilters() {
  const city = qCity.value.trim().toLowerCase();
  const type = qType.value;
  const availability = qAvailability.value;
  const sort = qSort.value;

  let filtered = photographers.filter(p => {
    if (city && !p.city.toLowerCase().includes(city)) return false;
    if (type && !p.services.some(s => s.key === type)) return false;
    if (availability === 'available' && !p.available) return false;
    if (availability === 'busy' && p.available) return false;
    return true;
  });

  if (sort === 'price_low') filtered.sort((a,b)=>a.price_from-b.price_from);
  else if (sort === 'new') filtered = filtered; // هنا لو كان لدينا تاريخ إنشاء نرتب حسبه
  else filtered.sort((a,b)=>b.rating - a.rating);

  results = filtered;
  renderCards(results);
}

/* Modal / profile */
const modal = document.getElementById('modalBackdrop');
const modalName = document.getElementById('modalName');
const modalCity = document.getElementById('modalCity');
const modalAbout = document.getElementById('modalAbout');
const modalGallery = document.getElementById('modalGallery');
const modalServices = document.getElementById('modalServices');
const modalReviews = document.getElementById('modalReviews');
const bookService = document.getElementById('bookService');
const bookDate = document.getElementById('bookDate');
const bookTime = document.getElementById('bookTime');
const bookingMsg = document.getElementById('bookingMsg');
let activePhotographer = null;

function openProfile(id) {
  const p = photographers.find(x => x.id === id);
  if (!p) return;
  activePhotographer = p;
  modalName.textContent = p.name;
  modalCity.textContent = p.city + ' — ⭐ ' + p.rating;
  modalAbout.textContent = p.about;
  modalGallery.innerHTML = p.gallery.map(u => `<img src="${u}" alt="عمل لـ ${p.name}" />`).join('');
  modalServices.innerHTML = p.services.map(s => `<div style="margin-top:8px">${s.name} — <strong>${s.price} ر.س</strong></div>`).join('');
  modalReviews.innerHTML = `<div class="meta">لا توجد مراجعات حالياً (نسخة تجريبية)</div>`;
  // services select
  bookService.innerHTML = p.services.map(s => `<option value="${s.key}__${s.price}">${s.name} — ${s.price} ر.س</option>`).join('');
  bookingMsg.style.display = 'none';
  // default date = today
  bookDate.valueAsDate = new Date();
  bookTime.value = '10:00';
  modal.style.display = 'flex';
}

/* close modal */
function closeModal(e) {
  if (e && e.target === modal) { modal.style.display = 'none'; return; }
  modal.style.display = 'none';
}

/* booking (محاكاة تخزين محلي) */
document.getElementById('confirmBooking').addEventListener('click', () => {
  const serviceVal = bookService.value;
  const [serviceKey, servicePrice] = serviceVal.split('__');
  const date = bookDate.value;
  const time = bookTime.value;
  if (!date || !time) { alert('اختار التاريخ والوقت'); return; }
  const booking = {
    id: 'b_' + Date.now(),
    photographerId: activePhotographer.id,
    photographerName: activePhotographer.name,
    date, time, serviceKey, servicePrice: Number(servicePrice),
    createdAt: new Date().toISOString()
  };
  const existing = JSON.parse(localStorage.getItem('kem_bookings') || '[]');
  existing.push(booking);
  localStorage.setItem('kem_bookings', JSON.stringify(existing));
  bookingMsg.style.display = 'block';
  bookingMsg.textContent = `تم تأكيد الحجز بتاريخ ${date} عند ${time} — التكلفة: ${servicePrice} ر.س (محليًا)`;
});

/* init */
document.getElementById('yr').textContent = new Date().getFullYear();
renderCards(photographers);
</script>

</body>
</html>